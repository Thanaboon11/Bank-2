<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏≠‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .calculator-btn {
            transition: all 0.2s;
        }
        .calculator-btn:hover {
            transform: scale(1.05);
        }
        .calculator-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-4">üìä ‡πÅ‡∏≠‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>
            <div class="flex flex-wrap gap-4 justify-center mb-6">
                <button onclick="showAddForm()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </button>
                <button onclick="showCalculator()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    üßÆ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç
                </button>
                <button onclick="exportToExcel()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel
                </button>
                <button onclick="saveData()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button onclick="loadData()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
            
            <!-- Date Filter -->
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="flex flex-wrap gap-4 items-center justify-center">
                    <div class="flex items-center gap-2">
                        <label class="text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ:</label>
                        <select id="yearFilter" onchange="filterData()" class="border border-gray-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
                        <select id="monthFilter" onchange="filterData()" class="border border-gray-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500">
                            <option value="">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                            <option value="01">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
                            <option value="02">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                            <option value="03">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                            <option value="04">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
                            <option value="05">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
                            <option value="06">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
                            <option value="07">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
                            <option value="08">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
                            <option value="09">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
                            <option value="10">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
                            <option value="11">‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
                            <option value="12">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
                        </select>
                    </div>
                    <button onclick="clearFilters()" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-1 rounded-lg text-sm font-medium transition-colors">
                        ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
                    </button>
                </div>
            </div>
        </div>

        <!-- Monthly Summary -->
        <div id="monthlySummary" class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
            <div id="summaryContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Monthly summaries will be inserted here -->
            </div>
        </div>

        <!-- Add Form Modal -->
        <div id="addModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md">
                    <h2 class="text-xl font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
                    <form id="addForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" id="date" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                            <input type="text" id="description" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
                            <input type="number" id="accountBalance" placeholder="0.00" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</label>
                            <input type="number" id="debit" placeholder="0.00" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</label>
                            <input type="number" id="credit" placeholder="0.00" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div class="flex gap-2 pt-4">
                            <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg font-medium transition-colors">
                                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                            </button>
                            <button type="button" onclick="hideAddForm()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg font-medium transition-colors">
                                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Calculator Modal -->
        <div id="calculatorModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">üßÆ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç</h2>
                        <button onclick="hideCalculator()" class="text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-4 mb-4">
                        <div id="calcDisplay" class="text-right text-2xl font-mono bg-white rounded px-3 py-2 min-h-[3rem] flex items-center justify-end">0</div>
                    </div>
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="clearCalc()" class="calculator-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">C</button>
                        <button onclick="calcInput('/')" class="calculator-btn bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-bold">√∑</button>
                        <button onclick="calcInput('*')" class="calculator-btn bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-bold">√ó</button>
                        <button onclick="deleteLast()" class="calculator-btn bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-bold">‚å´</button>
                        
                        <button onclick="calcInput('7')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">7</button>
                        <button onclick="calcInput('8')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">8</button>
                        <button onclick="calcInput('9')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">9</button>
                        <button onclick="calcInput('-')" class="calculator-btn bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-bold">-</button>
                        
                        <button onclick="calcInput('4')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">4</button>
                        <button onclick="calcInput('5')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">5</button>
                        <button onclick="calcInput('6')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">6</button>
                        <button onclick="calcInput('+')" class="calculator-btn bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-bold">+</button>
                        
                        <button onclick="calcInput('1')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">1</button>
                        <button onclick="calcInput('2')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">2</button>
                        <button onclick="calcInput('3')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">3</button>
                        <button onclick="calculate()" class="calculator-btn bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold row-span-2">=</button>
                        
                        <button onclick="calcInput('0')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold col-span-2">0</button>
                        <button onclick="calcInput('.')" class="calculator-btn bg-gray-200 hover:bg-gray-300 py-3 rounded-lg font-bold">.</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-xl font-bold text-gray-800">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
                <div class="mt-4 text-lg">
                    <span class="text-green-600 font-semibold">‡∏£‡∏ß‡∏°‡∏£‡∏±‡∏ö: ‡∏ø<span id="totalCredit">0.00</span></span>
                    <span class="ml-6 text-red-600 font-semibold">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢: ‡∏ø<span id="totalDebit">0.00</span></span>
                    <span class="ml-6 text-blue-600 font-semibold">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ‡∏ø<span id="netBalance">0.00</span></span>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let transactions = [];
        let filteredTransactions = [];
        let calcExpression = '';
        let calcResult = '0';

        // Initialize with today's date
        document.getElementById('date').value = new Date().toISOString().split('T')[0];

        // Load data on page load
        window.onload = function() {
            loadData();
            populateYearFilter();
        };

        // Modal functions
        function showAddForm() {
            document.getElementById('addModal').classList.remove('hidden');
        }

        function hideAddForm() {
            document.getElementById('addModal').classList.add('hidden');
            document.getElementById('addForm').reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        function showCalculator() {
            document.getElementById('calculatorModal').classList.remove('hidden');
        }

        function hideCalculator() {
            document.getElementById('calculatorModal').classList.add('hidden');
        }

        // Calculator functions
        function calcInput(value) {
            // If display shows result and user inputs a number, start fresh
            if (calcExpression === calcResult && !isNaN(value)) {
                calcExpression = value;
            } else if (calcExpression === '' && value === '0') {
                // Don't add leading zeros
                calcExpression = '0';
            } else if (calcExpression === '0' && !isNaN(value)) {
                // Replace initial zero with new number
                calcExpression = value;
            } else {
                // Add to existing expression
                calcExpression += value;
            }
            document.getElementById('calcDisplay').textContent = calcExpression || '0';
        }

        function clearCalc() {
            calcExpression = '';
            calcResult = '0';
            document.getElementById('calcDisplay').textContent = '0';
        }

        function deleteLast() {
            calcExpression = calcExpression.slice(0, -1);
            document.getElementById('calcDisplay').textContent = calcExpression || '0';
        }

        function calculate() {
            try {
                // Replace display symbols with actual operators
                let expression = calcExpression.replace(/√ó/g, '*').replace(/√∑/g, '/');
                calcResult = eval(expression).toString();
                document.getElementById('calcDisplay').textContent = calcResult;
                calcExpression = calcResult;
            } catch (error) {
                document.getElementById('calcDisplay').textContent = 'Error';
                calcExpression = '';
                calcResult = '0';
                setTimeout(() => {
                    document.getElementById('calcDisplay').textContent = '0';
                }, 1500);
            }
        }

        // Form submission
        document.getElementById('addForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('date').value;
            const description = document.getElementById('description').value;
            const accountBalance = parseFloat(document.getElementById('accountBalance').value) || 0;
            const debit = parseFloat(document.getElementById('debit').value) || 0;
            const credit = parseFloat(document.getElementById('credit').value) || 0;
            
            // Calculate remaining balance
            const remaining = accountBalance - debit + credit;
            
            const transaction = {
                id: Date.now(),
                date,
                description,
                accountBalance,
                debit,
                credit,
                remaining
            };
            
            transactions.push(transaction);
            updateTable();
            updateMonthlySummary();
            populateYearFilter();
            hideAddForm();
            
            // Auto-save
            saveData();
        });

        function populateYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            const years = [...new Set(transactions.map(t => new Date(t.date).getFullYear()))].sort((a, b) => b - a);
            
            // Clear existing options except "‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ"
            yearFilter.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>';
            
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 543; // Convert to Buddhist Era
                yearFilter.appendChild(option);
            });
        }

        function filterData() {
            const yearFilter = document.getElementById('yearFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            filteredTransactions = transactions.filter(transaction => {
                const transactionDate = new Date(transaction.date);
                const transactionYear = transactionDate.getFullYear();
                const transactionMonth = String(transactionDate.getMonth() + 1).padStart(2, '0');
                
                let yearMatch = !yearFilter || transactionYear == yearFilter;
                let monthMatch = !monthFilter || transactionMonth === monthFilter;
                
                return yearMatch && monthMatch;
            });
            
            updateTable();
            updateMonthlySummary();
        }

        function clearFilters() {
            document.getElementById('yearFilter').value = '';
            document.getElementById('monthFilter').value = '';
            filterData();
        }

        function updateMonthlySummary() {
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = '';
            
            // Group transactions by year-month
            const monthlyData = {};
            
            transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                
                if (!monthlyData[yearMonth]) {
                    monthlyData[yearMonth] = {
                        year: date.getFullYear(),
                        month: date.getMonth() + 1,
                        credit: 0,
                        debit: 0,
                        count: 0
                    };
                }
                
                monthlyData[yearMonth].credit += transaction.credit;
                monthlyData[yearMonth].debit += transaction.debit;
                monthlyData[yearMonth].count += 1;
            });
            
            // Sort by year-month descending
            const sortedMonths = Object.keys(monthlyData).sort((a, b) => b.localeCompare(a));
            
            if (sortedMonths.length === 0) {
                summaryContent.innerHTML = '<p class="text-gray-500 text-center col-span-full">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                return;
            }
            
            sortedMonths.forEach(yearMonth => {
                const data = monthlyData[yearMonth];
                const monthNames = ['', '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', 
                                  '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
                
                const card = document.createElement('div');
                card.className = 'bg-gradient-to-br from-blue-50 to-indigo-100 rounded-lg p-4 border border-blue-200';
                card.innerHTML = `
                    <h3 class="font-bold text-lg text-gray-800 mb-2">${monthNames[data.month]} ${data.year + 543}</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-green-600">‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô:</span>
                            <span class="font-semibold text-green-600">‡∏ø${data.credit.toLocaleString('th-TH', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-red-600">‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô:</span>
                            <span class="font-semibold text-red-600">‡∏ø${data.debit.toLocaleString('th-TH', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="text-blue-600">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span>
                            <span class="font-bold text-blue-600">‡∏ø${(data.credit - data.debit).toLocaleString('th-TH', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="flex justify-between text-gray-600">
                            <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span>
                            <span>${data.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </div>
                    </div>
                `;
                summaryContent.appendChild(card);
            });
        }

        function updateTable() {
            const tbody = document.getElementById('dataTable');
            tbody.innerHTML = '';
            
            let totalCredit = 0;
            let totalDebit = 0;
            
            const dataToShow = filteredTransactions.length > 0 || document.getElementById('yearFilter').value || document.getElementById('monthFilter').value 
                              ? filteredTransactions : transactions;
            
            // Sort transactions by date descending
            const sortedTransactions = [...dataToShow].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedTransactions.forEach(transaction => {
                totalCredit += transaction.credit;
                totalDebit += transaction.debit;
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(transaction.date).toLocaleDateString('th-TH')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right">‡∏ø${transaction.accountBalance.toLocaleString('th-TH', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 text-right">${transaction.debit > 0 ? '‡∏ø' + transaction.debit.toLocaleString('th-TH', {minimumFractionDigits: 2}) : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 text-right">${transaction.credit > 0 ? '‡∏ø' + transaction.credit.toLocaleString('th-TH', {minimumFractionDigits: 2}) : '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 text-right font-semibold">‡∏ø${transaction.remaining.toLocaleString('th-TH', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button onclick="deleteTransaction(${transaction.id})" class="text-red-600 hover:text-red-800 font-medium">‡∏•‡∏ö</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Update totals
            document.getElementById('totalCredit').textContent = totalCredit.toLocaleString('th-TH', {minimumFractionDigits: 2});
            document.getElementById('totalDebit').textContent = totalDebit.toLocaleString('th-TH', {minimumFractionDigits: 2});
            document.getElementById('netBalance').textContent = (totalCredit - totalDebit).toLocaleString('th-TH', {minimumFractionDigits: 2});
        }

        function deleteTransaction(id) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                transactions = transactions.filter(t => t.id !== id);
                updateTable();
                updateMonthlySummary();
                populateYearFilter();
                saveData();
            }
        }

        function saveData() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! üíæ');
        }

        function loadData() {
            const saved = localStorage.getItem('transactions');
            if (saved) {
                transactions = JSON.parse(saved);
                updateTable();
                updateMonthlySummary();
                populateYearFilter();
            }
        }

        function exportToExcel() {
            const dataToExport = filteredTransactions.length > 0 || document.getElementById('yearFilter').value || document.getElementById('monthFilter').value 
                               ? filteredTransactions : transactions;
            
            if (dataToExport.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
                return;
            }
            
            let csv = '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£,‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ,‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô,‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô,‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠\n';
            
            // Sort by date for export
            const sortedData = [...dataToExport].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            sortedData.forEach(transaction => {
                csv += `${transaction.date},"${transaction.description}",${transaction.accountBalance},${transaction.debit},${transaction.credit},${transaction.remaining}\n`;
            });
            
            // Add totals row
            const totalCredit = dataToExport.reduce((sum, t) => sum + t.credit, 0);
            const totalDebit = dataToExport.reduce((sum, t) => sum + t.debit, 0);
            csv += `\n‡∏£‡∏ß‡∏°,,,"${totalDebit}","${totalCredit}","${totalCredit - totalDebit}"\n`;
            
            // Add monthly summary if showing all data
            if (dataToExport === transactions) {
                csv += '\n\n‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô\n';
                csv += '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ,‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô,‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô,‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n';
                
                const monthlyData = {};
                transactions.forEach(transaction => {
                    const date = new Date(transaction.date);
                    const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    
                    if (!monthlyData[yearMonth]) {
                        monthlyData[yearMonth] = {
                            year: date.getFullYear(),
                            month: date.getMonth() + 1,
                            credit: 0,
                            debit: 0,
                            count: 0
                        };
                    }
                    
                    monthlyData[yearMonth].credit += transaction.credit;
                    monthlyData[yearMonth].debit += transaction.debit;
                    monthlyData[yearMonth].count += 1;
                });
                
                const monthNames = ['', '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', 
                                  '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
                
                Object.keys(monthlyData).sort().forEach(yearMonth => {
                    const data = monthlyData[yearMonth];
                    csv += `"${monthNames[data.month]} ${data.year + 543}",${data.credit},${data.debit},${data.credit - data.debit},${data.count}\n`;
                });
            }
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            
            // Create filename based on filter
            let filename = '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢';
            const yearFilter = document.getElementById('yearFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            
            if (yearFilter) filename += `_${parseInt(yearFilter) + 543}`;
            if (monthFilter) {
                const monthNames = ['', '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', 
                                  '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
                filename += `_${monthNames[parseInt(monthFilter)]}`;
            }
            filename += `_${new Date().toISOString().split('T')[0]}.csv`;
            
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! üìä');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98008191137ea048',t:'MTc1ODAyNzIwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
